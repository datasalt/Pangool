---
layout: user_guide
title: Pangool - User guide - Custom Comparators
---
<div class="hero-unit">
  <h1>Pangool User Guide</h1>
</div>

<h1>Custom Serialization</h1>

<p>
<br>
You can use your own custom stateful serialization for <b>OBJECT</b> fields creating
a serialization factory that implements <a href="http://hadoop.apache.org/common/docs/r0.20.0/api/org/apache/hadoop/io/serializer/Serialization.html">Serialization</a>.<br> 
As an example, you can take a look to 
<a href="https://github.com/datasalt/pangool/blob/master/core/src/main/java/com/datasalt/pangool/tuplemr/serialization/AvroFieldSerialization.java">AvroFieldSerialization</a>.
<br>

Implementing <a href="../apidocs/com/datasalt/pangool/io/Schema.Field.FieldConfigurable.html">FieldConfigurable</a> your serialization factory will receive 
the metadata associated with the <b>OBJECT</b> field to be serialized. <br>

<br>
Note how the <b>AvroFieldSerialization</b>'s state is retrieved from the field's properties <code>avro.schema</code> and <code>avro.reflection</code>  
<br>
</p><br>
<pre class="prettyprint" id="java">
  public class AvroFieldSerialization&lt;T&gt; implements Serialization&lt;T&gt;,FieldConfigurable{
    private Schema schema;
    private boolean isReflect;
    
    public AvroFieldSerialization(){
    }
  
    @Override
    public Deserializer&lt;T&gt; getDeserializer(Class&lt;T&gt; clazz) {
      return new AvroFieldDeserializer&lt;T&gt;(schema, isReflect);
    }
  
    @Override
    public Serializer&lt;T&gt; getSerializer(Class&lt;T&gt; clazz) {
      return new AvroFieldSerializer<T>(schema, isReflect);
    }
  
    @Override
    public void setFieldProperties(Map&lt;String,String&gt; properties) {
      schema = Schema.parse(properties.get("avro.schema"));
      String r = properties.get("avro.reflection");
      isReflect = (r != null) && Boolean.parseBoolean(r);
    }
 </pre>
 
<h2> Built-in serialization in Pangool</h2>
<p>
 There exist 4 types of built-in serializations supported in Pangool for OBJECT fields. 
 However, any other custom serialization can be added, as explained above. Let's show 
 how to define fields with them: 
</p>
 
<h3>Writables</h3>
<br>

<pre class="prettyprint" id="java">
  List&lt;Field&gt; fields = new ArrayList&lt;Field&gt;(); 
  fields.add(Field.createObject("my_writable", TextLongWritable.class);
  Schema schema = new Schema("schema", fields);
  
  Tuple tuple = new Tuple(schema);
  tuple.set("my_writable",new TextLongWritable("eric", 89L));
</pre>

<h3>Avro</h3>
<br>

<pre class="prettyprint" id="java">
  List&lt;Field&gt; fields = new ArrayList&lt;Field&gt;(); 
  fields.add(Fields.createAvroField("my_avro_field", myAvroSchema));
  Schema schema = new Schema("schema", fields);
  
  Tuple tuple = new Tuple(schema);
  Record avroRecord = new Record(myAvroSchema); //Avro Record
  tuple.set("my_avro_field", avroRecord);
</pre>

<h3>Thrift</h3>
<br>
<pre class="prettyprint" id="java">
  List&lt;Field&gt; fields = new ArrayList&lt;Field&gt;(); 
  fields.add(Field.createObject("my_thrift_field", MyThrifObject.class));
  Schema schema = new Schema("schema", fields);
  
  Tuple tuple = new Tuple(schema1);
  tuple.set("my_thrift_field",new MyThriftObject());
</pre>

<h3>Protostuff</h3>
<br>
<pre class="prettyprint" id="java">
  List&lt;Field&gt; fields = new ArrayList&lt;Field&gt;(); 
  fields.add(Field.createObject("my_protostuff_field", MyProtoStuffObject.class));
  Schema schema = new Schema("schema", fields);
  
  Tuple tuple = new Tuple(schema);
  tuple.set("my_protostuff_field",new MyProtostuffObject());
</pre>

<h3>Pangool (Tuple inside Tuple)</h3>
<br>
(It is possible to serialize Pangool Tuples inside Pangool Tuples.)
<br>
<pre class="prettyprint" id="java">
  Schema tupleSchema = new Schema(...);
  List&lt;Field&gt; fields = new ArrayList&lt;Field&gt;(); 
  fields.add(Fields.createTupleField("my_tuple_field", tupleSchema));
  Schema metaTupleSchema = new Schema("schema", fields);
  
  Tuple tuple = new Tuple(tupleSchema);
  ...
  Tuple metaTuple = new Tuple(metaTupleSchema);
  metaTuple.set("my_tuple_field", tuple);
</pre>

<p><a class="btn btn-primary btn-large" href="comparators.html">Next: Custom Comparators &raquo;</a></p>